<div class="navbar navbar-default navbar-static-top" role="navigation">
  <div class="container">
    <div class="navbar-brand">
      <a href="<%= root_path %>"><%= image_tag "wca_logo.svg" %></a>
      <span>
        <a href="<%= root_path %>">World Cube Association</a>
        <br>
        <%= link_to(icon("fab", "instagram"), "https://www.instagram.com/thewcaofficial/", target: "_blank", class: "hide-new-window-icon") %>
        <%= link_to(icon("fab", "facebook-square"), "https://www.facebook.com/WorldCubeAssociation/", target: "_blank", class: "hide-new-window-icon") %>
        <%= link_to(icon("fab", "twitter"), "https://www.twitter.com/theWCAofficial/", target: "_blank", class: "hide-new-window-icon") %>
        <%= link_to(icon("fab", "reddit"), "https://www.reddit.com/r/TheWCAOfficial/", target: "_blank", class: "hide-new-window-icon") %>
        <%= link_to(icon("fab", "twitch"), "https://www.twitch.tv/worldcubeassociation/", target: "_blank", class: "hide-new-window-icon") %>
        <%= link_to(icon("fab", "weibo"), "https://www.weibo.com/theWCA/", target: "_blank", class: "hide-new-window-icon") %>
        <%= link_to(icon("fab", "youtube"), "https://www.youtube.com/channel/UC5OUMUnS8PvY1RvtB1pQZ0g", target: "_blank", class: "hide-new-window-icon") %>
      </span>
    </div>
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    </div>
    <div class="navbar-collapse collapse disabled">
      <ul class="nav navbar-nav">
        <li class="dropdown <%= Set['static_pages', 'posts'].include?(params[:controller]) ? 'active' : '' %>">
          <a href="/" class="dropdown-toggle top-nav" data-toggle="dropdown" data-hover="dropdown">
            <%= icon('fa', 'info-circle') %> <span class="hidden-sm"><%= t '.information' %></span> <span class="caret"></span>
          </a>
          <ul class="dropdown-menu" role="menu">
            <li><a href="<%= about_path %>"><%= icon('fas', 'file-alt') %> <%= t '.about' %></a></li>
            <li><a href="<%= documents_path %>"><%= icon('fas', 'copy') %> <%= t '.documents' %></a></li>
            <li><a href="<%= delegates_path %>"><%= icon('fas', 'sitemap') %> <%= t '.delegates' %></a></li>
            <li><a href="<%= teams_committees_path %>"><%= icon('fas', 'id-badge') %> <%= t '.teams' %></a></li>
            <li><a href="<%= organizations_path %>"><%= icon('fas', 'flag') %> <%= t '.organizations' %></a></li>
            <li class="divider"></li>
            <li><a href="<%= faq_path %>"><%= icon('fas', 'question-circle') %> <%= t '.faq' %></a></li>
            <li><a href="<%= tutorial_path %>"><%= icon('fas', 'graduation-cap') %> <%= t '.tutorial' %></a></li>
            <li><a href="<%= contact_website_path %>"><%= icon('fas', 'envelope') %> <%= t '.contact' %></a></li>
            <li><a href="<%= privacy_path %>"><%= icon('fas', 'user-secret') %> Privacy</a></li>
            <li><a href="<%= disclaimer_path %>"><%= icon('fas', 'exclamation-circle') %> Disclaimer</a></li>
            <li class="divider"></li>
            <li><a href="<%= score_tools_path %>"><%= icon('fas', 'wrench') %> <%= t '.tools' %></a></li>
            <li><a href="<%= logo_path %>"><i><%= image_tag('wca_logo.svg', width: '16px') %></i> <%= t '.logo' %></a></li>
          </ul>
        </li>
        <li class="dropdown <%= Set['competitions', 'delegate_reports', 'results_submission'].include?(params[:controller]) ? 'active' : '' %>">
          <a href="" class="dropdown-toggle top-nav" data-toggle="dropdown" data-hover="dropdown">
             <%= icon('fas', 'cube') %> <%= t '.competitions' %> <span class="caret"></span>
          </a>
          <ul class="dropdown-menu" role="menu">
            <li><a href="<%= competitions_path %>"><%= icon('fas', 'globe') %> <%= t '.all' %></a></li>
            <li><a href="<%= my_comps_path %>"><%= icon('fas', 'list') %> <%= t '.my_competitions' %></a></li>
            <% if current_user&.can_create_competitions? %>
              <li><a href="<%= new_competition_path %>"><%= icon('fas', 'plus') %> <%= t '.new_competition' %></a></li>
            <% end %>
          </ul>
        </li>
        <li class="dropdown <%= Set['results', 'persons', 'media'].include?(params[:controller]) ? 'active' : '' %>">
          <a href="" class="dropdown-toggle top-nav" data-toggle="dropdown" data-hover="dropdown">
            <%= icon('fas', 'list-ol') %> <%= t '.results' %> <span class="caret"></span>
          </a>
          <ul class="dropdown-menu" role="menu">
            <li><a href="https://live.worldcubeassociation.org"><%= icon('fa', 'sort-numeric-down') %>WCA Live</a></li>
            <li class="divider"></li>
            <li><a href="<%= rankings_path("333", "single") %>"><%= icon('fas', 'signal', class: 'fa-rotate-90') %> <%= t '.rankings' %></a></li>
            <li><a href="/results/regions.php"><%= icon('fas', 'trophy') %> <%= t '.records' %></a></li>
            <li><a href="<%= persons_path %>"><%= icon('fas', 'users') %> <%= t '.persons' %></a></li>
            <% if current_user&.wca_id? %>
              <li><%= link_to icon('fas', 'user', t('.my_results')), person_path(current_user.wca_id) -%></li>
            <% end %>
            <li class="divider"></li>
            <li><a href="/results/statistics.php"><%= icon('fas', 'chart-area') %> <%= t '.statistics' %></a></li>
            <li><a href="<%= media_path %>"><%= icon('fas', 'film') %> <%= t '.multimedia' %></a></li>
            <li><a href="/results/misc/export.html"><%= icon('fas', 'download') %> <%= t '.db_export' %></a></li>
          </ul>
        </li>
        <li class="dropdown <%= Set['incidents', 'regulations', 'wdc'].include?(params[:controller]) ? 'active' : '' %>">
          <a href="/regulations/" class="dropdown-toggle top-nav" data-toggle="dropdown" data-hover="dropdown">
            <%= icon('fas', 'book') %> <span class="hidden-sm"><%= t '.regulations' %></span> <span class="caret"></span>
          </a>
          <ul class="dropdown-menu" role="menu">
            <li><a href="/regulations/about"><%= icon('fas', 'info-circle') %> <%= t '.about_regulations' %></a></li>
            <li class="divider"></li>
            <li><a href="/regulations/"><%= icon('fas', 'book') %> <%= t '.regulations' %></a></li>
            <li><a href="/regulations/guidelines.html"><%= icon('fas', 'sticky-note') %> <%= t '.guidelines' %></a></li>
            <li><a href="/regulations/scrambles/"><%= icon('fas', 'random') %> <%= t '.scrambles' %></a></li>
            <li><%= link_to(icon('fas', 'balance-scale', t('.incidents')), incidents_path) %></li>
            <li><%= link_to(icon('fas', 'bullhorn', t('.disciplinary')), disciplinary_path) %></li>
            <li class="divider"></li>
            <li><a href="/regulations/history/"><%= icon('fas', 'history') %> <%= t '.history' %></a></li>
            <li><a href="/regulations/translations/"><%= icon('fas', 'language') %> <%= t '.translations' %></a></li>
          </ul>
        </li>
      </ul>

      <form class="navbar-form navbar-left" role="search">
        <%= wca_omni_search %>
      </form>

      <ul class="nav navbar-nav navbar-right">
        <li class="dropdown">
          <a href="#" class="dropdown-toggle top-nav" data-toggle="dropdown" data-hover="dropdown">
            <% active_locale_info = Locales::AVAILABLE[I18n.locale] %>
            <%= flag_icon active_locale_info[:flag_id] %> <span class="hidden-sm"><%= active_locale_info[:name] %></span>
            <span class="caret"></span>
          </a>
          <ul class="dropdown-menu" id="locale-selector" role="menu">
            <% Locales::AVAILABLE.each do |l, data| %>
              <li class="<%= l == I18n.locale ? "active" : "" %>">
                <%= link_to update_locale_path(l) do %>
                  <%= flag_icon data[:flag_id] %> <%= data[:name] %>
                <% end %>
              </li>
            <% end %>
          </ul>
        </li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle top-nav" data-toggle="dropdown" data-hover="dropdown">
            <% if current_user %>
              <% notification_count = notifications_for_user(current_user).length %>
              <%= render "shared/user_avatar", user: current_user, do_not_show_full_image_on_hover: true %>
              <% if notification_count > 0 %>
                <span class="badge"><%= notification_count %></span>
              <% end %>
            <% else %>
              <%= t 'devise.shared.links.sign_in' %>
            <% end %>
            <span class="caret"></span>
          </a>
          <ul class="dropdown-menu" role="menu">
            <% if current_user %>
              <li role="presentation" class="dropdown-header">
                <%= current_user.name %>
              </li>
              <li>
                <%= link_to notifications_path do %>
                  <%= t '.notifications' %>
                  <% if notification_count > 0 %>
                    <span class="badge"><%= notification_count %></span>
                  <% end %>
                <% end %>
              </li>
              <li><%= link_to t('.edit_profile'), profile_edit_path %></li>

              <li class="divider"></li>
              <li><%= link_to t('.my_competitions'), my_comps_path %></li>

              <% if current_user.wca_id? %>
                <li><%= link_to t('.my_results'), person_path(current_user.wca_id) %></li>
              <% end %>

              <% if current_user.staff? %>
                <li class="divider"></li>
                <li><%= link_to t('.panel'), panel_path %></li>
              <% end %>
              <% if current_user.can_wiew_polls? %>
                <li><%= link_to t('.polls'), polls_path %></li>
              <% end %>

              <% if current_user.can_view_all_users? %>
                <li class="divider"></li>
                <li role="presentation" class="dropdown-header">
                  <%= t '.administration' %>
                </li>
                <li><%= link_to t('.manage_users'), users_path %></li>
              <% end %>

              <% if current_user.can_view_delegate_matters? %>
                <li class="divider"></li>
                <li role="presentation" class="dropdown-header">
                  <%= t '.delegate' %>
                </li>
                <li><%= link_to t('.new_competition'), new_competition_path if current_user.can_create_competitions? %></li>
              <% end %>

              <% if current_user.can_admin_results? %>
                <li class="divider"></li>
                <li role="presentation" class="dropdown-header">
                  <%= t '.results_team' %>
                </li>
                <li><%= link_to t('.results_admin'), admin_path %></li>
                <li><%= link_to t('.competitions'), competitions_path %></li>
                <li><%= link_to t('.results_phpmyadmin'), '/results/admin/phpMyAdmin/' %></li>
              <% end %>

              <% if current_user.can_create_posts? %>
                <li class="divider"></li>
                <li><%= link_to t('.new_post'), new_post_path %></li>
              <% end %>

              <% unless current_user.teams_where_is_leader.empty? %>
                <li class="divider"></li>
                <li role="presentation" class="dropdown-header">
                  <%= t '.team_leader' %>
                </li>
                <% current_user.teams_where_is_leader.each do |team| %>
                  <li><%= link_to team.name, edit_team_path(team) %></li>
                <% end %>
              <% end %>

              <% if current_user.can_manage_regional_organizations? %>
                <li class="divider"></li>
                <li role="presentation" class="dropdown-header">
                  <%= t '.regional_organizations' %>
                </li>
                <li><%= link_to t('.manage_regional_organizations'), admin_regional_organizations_path %></li>
                <li><%= link_to t('.new_regional_organization'), new_regional_organization_path %></li>
              <% end %>

              <!-- Don't show the link for admins, as they have it in the dedicated admin navigation. -->
              <% if current_user.can_see_eligible_voters? && !current_user.can_admin_results? %>
                <li class="divider"></li>
                <li><%= link_to "WCA Voting Members", eligible_voters_path %></li>
                <li><%= link_to "WCA Leaders and Seniors", leader_senior_voters_path %></li>
              <% end %>

              <li class="divider"></li>
              <li><%= link_to t('.api'), api_path %></li>
              <li><%= link_to t('.manage_app'), oauth_applications_path %></li>
              <li><%= link_to t('.manage_auth_app'), oauth_authorized_applications_path %></li>

              <li class="divider"></li>
              <li><%= link_to(t('.sign_out'), destroy_user_session_path, :method => :delete) %></li>
            <% else %>
              <li><%= link_to(t('devise.shared.links.sign_in'), new_user_session_path, class: "top-nav") %></li>
              <li class="divider"></li>
              <li><%= link_to(t('devise.shared.links.sign_up'), new_user_registration_path) %></li>
              <li><%= link_to(t('devise.shared.links.didn_t_receive_confirmation_instructions'), new_user_confirmation_path) %></li>
            <% end %>
          </ul>
        </li>
      </ul>
    </div><!--/.nav-collapse -->
  </div>
</div>

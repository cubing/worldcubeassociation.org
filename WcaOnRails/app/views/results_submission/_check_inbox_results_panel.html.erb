<%
  already_has_submitted_result ||= false
  total_errors ||= 0
  total_warnings ||= 0
  all_errors ||= {}
  all_warnings ||= {}
  panel_style = if !already_has_submitted_result || total_errors > 0
                  "danger"
                elsif total_warnings > 0
                  "warning"
                else
                  "success"
                end
%>
<div class="panel panel-<%= panel_style %>">
  <div class="panel-heading heading-as-link <%= "collapsed" unless already_has_submitted_result %>" data-toggle="collapse" data-target="#collapse-check-results">
    <h3 class="panel-title">
      Check imported results
      <span class="collapse-indicator"></span>
    </h3>
  </div>
  <div id="collapse-check-results" class="panel-body collapse <%= "in" if already_has_submitted_result %>">
    <h3>Errors</h3>
    <% if total_errors > 0 %>
      <p>Please fix the errors below:</p>
      <% all_errors.each do |type, errors| %>
        <% if errors.any? %>
          <h4>Errors detected in <%= type %></h4>
          <ul>
            <% errors.each do |error| %>
              <li><%= error %></li>
            <% end %>
          </ul>
        <% end %>
      <% end %>
    <% elsif !already_has_submitted_result %>
      <p class="text-danger">No results submitted yet.</p>
    <% else %>
      <p>No error detected in the submitted results.</p>
    <% end %>
    <h3>Warnings</h3>
    <% if total_warnings > 0 %>
      <p>Please pay attention to the warnings below. You may need to add a comment about them when submitting these results to the WRT!</p>
      <% all_warnings.each do |type, warnings| %>
        <% if warnings.any? %>
          <h4>Warnings detected in <%= type %></h4>
          <ul>
            <% warnings.each do |warning| %>
              <li><%= warning %></li>
            <% end %>
          </ul>
        <% end %>
      <% end %>
    <% elsif !already_has_submitted_result %>
      <p class="text-danger">No results submitted yet.</p>
    <% else %>
      <p>No warning detected in the submitted results.</p>
    <% end %>
  </div>
</div>

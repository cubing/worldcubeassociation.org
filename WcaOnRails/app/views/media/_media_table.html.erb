<% show_edit_buttons = defined?(show_edit_buttons) && show_edit_buttons %>

<script>
  function sortBySorter(a, b) {
    return b['sort-by'] - a['sort-by'];
  }
</script>

<form action="" method="get" class="form-inline">
  <div class="form-group">
    <label for="year-selector">Year</label>
    <%= select_tag "year",
                   year_option_tags(selected_year: params[:year], future: false),
                   id: "year-selector",
                   class: "form-control"
    %>
  </div>

  <div class="form-group">
    <%= label_tag(t('competitions.index.region')) %>
    <%= select_tag(:region, region_option_tags(selected_id: params[:region]), class: "form-control") %>
  </div>

  <% if show_edit_buttons %>
    <div class="form-group">
      <label for="status-selector">Status</label>
      <%= select_tag "status",
                     options_for_select(CompetitionMedium.statuses_i18n.invert, params[:status]),
                     id: "status-selector",
                     class: "form-control"
      %>
    </div>
  <% end %>

  <input type="submit" class="btn btn-default" value="Filter" />
</form>

<%= wca_table table_class: "media", data: { toggle: "table", sort_name: "submission-date", sort_order: "desc" } do %>
  <thead>
    <tr>
      <th data-sortable="true" data-field="submission-date" data-sort-name="_submission-date_data" data-sorter="sortBySorter">Submission Date</th>
      <th data-sortable="true" data-field="competition-date" data-sort-name="_competition-date_data" data-sorter="sortBySorter">Competition Date</th>
      <th>Competition</th>
      <th>Country, City</th>
      <th>Type</th>
      <th>Link</th>
      <th></th>

      <!-- Extra column for .table-greedy-last-column -->
      <th></th>
    </tr>
  </thead>

  <tbody>
    <% media.each do |medium| %>
      <% competition = medium.competition %>
      <tr data-medium-id="<%= medium.id %>">
        <td data-sort-by="<%= medium.timestampSubmitted.to_i %>"><%= medium.timestampSubmitted.to_formatted_s(:long_utc) %></td>
        <td data-sort-by="<%= competition.start_date.to_time.to_i %>">
          <%= wca_date_range(competition.start_date, competition.end_date) %>
        </td>
        <td><%= link_to competition.name, competition_path(competition) %></td>
        <td><strong><%= competition.country.name %></strong>, <%= competition.cityName %></td>
        <td><%= medium.type %></td>
        <td><%= link_to medium.text, medium.uri %></td>
        <% if show_edit_buttons %>
          <td>
            <% if medium.pending? %>
              <%= button_to medium_path(medium),
                            title: "Accept",
                            class: "btn btn-link",
                            method: :patch,
                            params: { "competition_medium[status]" => "accepted" },
                            data: { confirm: "Are you sure you want to accept this medium?" } do
              %>
                <%= icon("check") %>
              <% end %>
            <% end %>
            <%= link_to icon("pencil"), edit_medium_path(medium), title: "Edit" %>
            <%= button_to medium_path(medium),
                          title: "Delete",
                          class: "btn btn-link",
                          method: :delete,
                          data: { confirm: "Are you sure you want to delete this medium?" } do
            %>
              <%= icon("trash") %>
            <% end %>
          </td>
        <% end %>
        <!-- Extra column for .table-greedy-last-column -->
        <td></td>
    <% end %>
  </tbody>
<% end %>

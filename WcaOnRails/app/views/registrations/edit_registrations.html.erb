<% provide(:title, I18n.t('registrations.list.title', comp: @competition.name)) %>

<%= render layout: 'nav' do %>

  <%= form_for @competition, url: competition_registrations_do_actions_for_selected_path(@competition), remote: true do |f| %>
    <% [:pending, :accepted].each do |status| %>
      <% if :pending == status %>
        <h2><%= t 'registrations.list.waiting_list' %></h2>
      <% else %>
        <h2><%= t 'registrations.list.approved_registrations' %></h2>
      <% end %>
      <% registrations = @competition.registrations.public_send(status).includes(:user, :events) %>
      <%= wca_table table_class: "registrations-table #{status}",
                    data: { toggle: "table", sort_name: "registration-date", select_item_name: "selected_registrations[]", click_to_select: "true" } do %>

        <%= render "header" %>
        <tbody>
          <% registrations.each_with_index do |registration, i| %>
            <%= render "row", registration: registration, registration_events: @registered_event_matrix[status][i] %>
          <% end %>
        </tbody>

        <%= render "edit_registrations_table_footer", registrations: registrations, status: status %>
      <% end %>
    <% end %>

    <div id="registrations-actions" class="btn-group" role="group">
      <button type="submit" class="btn btn-info selected-registrations-actions" name="registrations_action" value="export-selected">
        <%= icon 'download', t('registrations.list.export_csv') %>
      </button>
      <a href="#" id="email-selected" target="_blank" class="btn btn-info selected-registrations-actions">
        <%= icon 'envelope', t('registrations.list.email') %>
      </a>
      <button type="submit" class="btn btn-success selected-pending-registrations-actions" name="registrations_action" value="accept-selected">
        <%= icon 'check', t('registrations.list.approve') %>
      </button>
      <button type="submit" class="btn btn-warning selected-approved-registrations-actions" name="registrations_action" value="reject-selected">
        <%= icon 'times', t('registrations.list.reject') %>
      </button>
      <button type="submit" class="btn btn-danger selected-registrations-actions" name="registrations_action" value="delete-selected">
        <%= icon 'trash', t('registrations.list.delete') %>
      </button>
    </div>
  <% end %>

<% end %>
